{
	"Crear pipeline Notificaciones": {
		"prefix": "pipelineSlack",
		"body": [
			"//variables: $nombrePipeline $nombreArchivo  $pipelineNotificar $usuario",
			"{",
				"\t\"name\": \"$nombrePipeline\",",
				"\t\"type\": \"ExecutePipeline\",",
				"\t\"dependsOn\": [",
					"\t\t{",
						"\t\t\t\"activity\": \"$pipelineNotificar\",",
						"\t\t\t\"dependencyConditions\": [",
							"\t\t\t\t\"Succeeded\",",
							"\t\t\t\t\"Failed\"",
						"\t\t\t]",
					"\t\t}",
				"\t],",
				"\t\"userProperties\": [],",
				"\t\"typeProperties\": {",
					"\t\t\"pipeline\": {",
						"\t\t\t\"referenceName\": \"NotificacionesSlack\",",
						"\t\t\t\"type\": \"PipelineReference\"",
					"\t\t},",
					"\t\t\"waitOnCompletion\": true,",
					"\t\t\"parameters\": {",
						"\t\t\t\"nombreElemento\": {",
							"\t\t\t\t\"value\": \"$nombreArchivo\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"idPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').output['pipelineRunId']\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"inicioPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').ExecutionStartTime\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"finPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').ExecutionEndTime\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"duracionPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').Duration\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"responsable\": \"$usuario\",",
						"\t\t\t\"nombrePipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').output['pipelineName']\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"estadoPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').Status\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t},",
						"\t\t\t\"errorPipeline\": {",
							"\t\t\t\t\"value\": \"@if(empty(activity('$pipelineNotificar').Error?.message), '✅\\n `No hubo errores durante la ejecución.`', concat('⚠\\n', '`', activity('$pipelineNotificar').Error.message, '`'))\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t}",
					"\t\t}",
				"\t}",
			"}"
		],
		"description": "Crear pipeline de notificaciones en ADF"
	},
	"Crear notebook Notificaciones": {
		"prefix": "notebookSlack",
		"body": [
			"//variables: $nombreNotebook $nombreArchivo  $pipelineNotificar $usuario",
			"{",
				"\t\"name\": \"$nombreNotebook\",",
				"\t\"type\": \"DatabricksNotebook\",",
				"\t\"dependsOn\": [",
					"\t\t{",
						"\t\t\t\"activity\": \"$pipelineNotificar\",",
						"\t\t\t\"dependencyConditions\": [",
							"\t\t\t\t\"Succeeded\",",
							"\t\t\t\t\"Failed\"",
						"\t\t\t]",
					"\t\t}",
				"\t],",
				"\t\"policy\": {",
                    "\t\t\"timeout\": \"7.00:00:00\",",
                    "\t\t\"retry\": 0,",
                    "\t\t\"retryIntervalInSeconds\": 30,",
                    "\t\t\"secureOutput\": false,",
                    "\t\t\"secureInput\": false",
				"\t},",
				"\t\"userProperties\": [],",
				"\t\"typeProperties\": {",
					"\t\t\"notebookPath\": \"/Users/exftapj@bci.cl/Notificaciones Slack\",",
					"\t\t\"baseParameters\": {",
						"\t\t\t\"idPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').output['pipelineRunId']\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"nombreArchivo\": \"$nombreArchivo\",",
						"\t\t\t\"estadoPipeline\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').Status\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"inicioEjecucion\": {",
							"\t\t\t\t\"value\": \"@formatDateTime(convertTimeZone(activity('$pipelineNotificar').ExecutionStartTime, 'UTC', 'Pacific SA Standard Time'), 'dd-MM-yyyy hh:mm:ss tt')\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"finEjecucion\": {",
						"\t\t\t\t\"value\": \"@formatDateTime(convertTimeZone(activity('$pipelineNotificar').ExecutionEndTime, 'UTC', 'Pacific SA Standard Time'), 'dd-MM-yyyy hh:mm:ss tt')\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"tiempoEjecucion\": {",
							"\t\t\t\t\"value\": \"@activity('$pipelineNotificar').Duration\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"errorEjecucion\": {",
							"\t\t\t\t\"value\": \"@if(empty(activity('$pipelineNotificar').Error?.message), 'No se encontraron errores durante la ejecución', activity('$pipelineNotificar').Error.message)\",",
							"\t\t\t\t\"type\": \"Expression\"",
						"\t\t\t},",
						"\t\t\t\"usuario\": \"$usuario\"",
					"\t\t}",
				"\t},",
				"\t\"linkedServiceName\": {",
					"\t\t\"referenceName\": \"Lnk_Databricks_BigData\",",
					"\t\t\"type\": \"LinkedServiceReference\"",
				"\t}",
			"}"
		],
		"description": "Crear notebook de notificaciones SLACK"
	}
}